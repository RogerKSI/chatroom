<!DOCTYPE html>
<html>
	<head>
		<meta charset='utf-8'>
		<title>Chat Example</title>

		<!--Import Google Icon Font-->
		<link href="http://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<!--Import materialize.css-->
		<link type="text/css" rel="stylesheet" href="resources/css/materialize.min.css"  media="screen,projection"/>
		<link type="text/css" rel="stylesheet" href="resources/css/style.css" />

		<!--Let browser know website is optimized for mobile-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	</head>

	<body>
		<!--Import jQuery before materialize.js-->
		
		<div class="container">
			<div id="log" style="height: 60vh">
			</div>
			<form id="form">
				message: <input type="text" id="msg" size="64"/>
			 <button class="btn waves-effect waves-light" type="submit" name="action">Submit
					<i class="material-icons right">send</i>
				</button>
			</form>		
		</div>
		
		
		<script type="text/javascript" src="
		https://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="resources/js/materialize.min.js"></script>
		<script type="text/javascript">
			window.onload = function () {
					var conn;
					var msg = document.getElementById("msg");
					var log = document.getElementById("log");

					function appendLog(item) {
							var doScroll = log.scrollTop > log.scrollHeight - log.clientHeight - 1;
							log.appendChild(item);
							if (doScroll) {
									log.scrollTop = log.scrollHeight - log.clientHeight;
							}
					}

					document.getElementById("form").onsubmit = function () {
							if (!conn) {
									return false;
							}
							if (!msg.value) {
									return false;
							}
							conn.send(msg.value);
							msg.value = "";
							return false;
					};

					if (window["WebSocket"]) {
							//conn = new WebSocket("ws://" + document.location.host + "/ws/111");
							group = document.location.href.split('/');
							conn = new WebSocket("ws://" + document.location.host + "/ws/" + group[group.length-1]);
							conn.onclose = function (evt) {
									var item = document.createElement("div");
									item.innerHTML = "<b>Connection closed.</b>";
									appendLog(item);
							};
							conn.onmessage = function (evt) {
									var messages = evt.data.split('\n');
									for (var i = 0; i < messages.length; i++) {
											var item = document.createElement("div");
											item.innerText = messages[i];
											appendLog(item);
									}
							};
					} else {
							var item = document.createElement("div");
							item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
							appendLog(item);
					}
			};
		</script>
	</body>
</html>